\ProvidesPackage{beamerthemeemarsden}
\NeedsTeXFormat{LaTeX2e}[1995/12/01]

%% emarsden2007-12-31 changed all instances of
%% ``averagebackgroundcolor'' to ``bg''

% Mini slides in headline
\beamertemplatecircleminiframe

% \beamertemplatetransparentcovereddynamic

% \beamertemplatenumberedcirclesectiontoc
\beamertemplateballitem
\usesubitemizetemplate{}{}


% Title page  
\usetitlepagetemplate{
  \vbox{}
  \vfill
  \begin{centering}
    \Large\structure{\textrm{\textit{{\inserttitle}}}}
    \vskip1em\par
    \normalsize\insertauthor\vskip1em\par
    {\scriptsize\insertinstitute\par}\par\vskip1em
    \insertdate\par\vskip1.5em
    \inserttitlegraphic
  \end{centering}
  \vfill
  }

                                % Part page  
\usepartpagetemplate{
  \begin{centering}
    \Large\structure{\textrm{\textit{\partname~\@Roman\c@part}}}
    \vskip1em\par
    \textrm{\textit{\insertpart}}\par
  \end{centering}
  }

                                % Frametitles
\useframetitletemplate{%
  \vskip1.1em
  {% \leftskip-\beamer@leftmargin plus1fill\advance\leftskip by0.3cm%
   % \rightskip-\beamer@rightmargin plus1fill\advance\rightskip by0.3cm\leavevmode
    \color{structure}\huge\textrm{\textit{\insertframetitle}}\par}
  }

                                % Sections in headline
\usesectionheadtemplate
{\color{structure}\tiny\textrm{\textsc{\insertsectionhead}}}
{\color{structure!15}\tiny\textrm{\textsc{\insertsectionhead}}}

% \usesectionheadtemplate
% {\color{structure}\tiny\textrm{\textsc{\insertsectionhead}}}
% {\color{white}\tiny\textrm{\textsc{\insertsectionhead}}}


                                % Entries in table of contents
\usetemplatetocsection[50!bg]
{{\large\color{structure}\textrm{\textit{{\inserttocsection}}}}}

                                % Entries in table of contents
\usetemplatetocsubsection[50!bg]
{\leavevmode\leftskip=1.5em\color{black}\inserttocsubsection\par}

% \RequirePackage{pgfshade}

\pgfdeclareverticalshading{headfade}{\paperwidth}
{color(0cm)=(bg);
  color(1.25cm)=(structure!50!bg)}

\AtBeginDocument{% redo at begin of document to catch changed background color
\pgfdeclareverticalshading{headfade}{\paperwidth}
{color(0cm)=(bg);
  color(1.25cm)=(structure!50!bg)}}

% Head
\useheadtemplate{}

% Footline
%
\usefoottemplate{%
  \vbox{%
    \beamerline{\pgfuseshading{headfade}}%
    \vskip-1.25cm%
    \tinycolouredline{structure!40}%
       {\color{black}{\insertsectionnavigationhorizontal{\textwidth}{\hskip0pt plus1fill}{}}\hfill\insertframenumber}%
  }}

    % \tinycolouredline{structure!75}{\color{black}{\insertsection}}
    % \setbox\beamer@tempbox=\hbox{\insertsubsection}%
    % \tinycolouredline{structure!50}{\color{black}\ifdim\wd\beamer@tempbox>1pt{\hskip9.4pt\raise1.9pt\hbox{\vrule
    % width0.4pt height1.875ex\vrule width 5pt height0.4pt}}%
    % \hskip1pt{\insertsubsectionnavigationhorizontal{\textwidth}{\hskip0pt plus1fill}{}}
    % \fi\hfill\ht\beamer@logobox=0pt\box\beamer@logobox%
    % \beamerline{\insertnavigation{\paperwidth}}



                                % Blocks
\useblocktemplate{\medskip{\color{structure}\large{\insertblockname}}\par}{\medskip}
\usealertblocktemplate{\medskip{\alert{\large{\insertblockname}}}\par}{\medskip}
\useexampleblocktemplate{\medskip\begingroup{\color{structure!50!green}\large{\insertblockname}}\par%
\color{black!50!green}}{\endgroup\medskip}

 
                                % Itemize
% \useitemizeitemtemplate{\tiny\raise1.5pt\hbox{\color{structure}$\blacktriangleright$}}
% \usesubitemizeitemtemplate{\tiny\raise1.5pt\hbox{\color{structure}\textbullet}}
\usesubitemizeitemtemplate{\tiny\raise1.5pt\hbox{\color{structure}$\blacktriangleright$}}


